<!doctype html>
<html>

<head>
   <!-- shared -->
   <link rel="stylesheet" href="./src/shared/shared.css">
   <link rel="stylesheet" href="./src/shared/icons.css">

   <!-- components -->
   <link rel="stylesheet" href="./src/components/Appbar/Appbar.css" />
   <script src="./src/components/Appbar/Appbar.js"></script>
   <link rel="stylesheet" href="./src/components/Pallet/Pallet.css" />
   <script src="./src/components/Pallet/Pallet.js"></script>
   <link rel="stylesheet" href="./src/components/Canvas/Canvas.css" />
   <script src="./src/components/Canvas/Canvas.js"></script>
   <link rel="stylesheet" href="./src/components/Easel/Easel.css" />
   <script src="./src/components/Easel/Easel.js"></script>
   <link rel="stylesheet" href="./src/components/Toolbox/Toolbox.css" />
   <script src="./src/components/Toolbox/Toolbox.js"></script>
   <link rel="stylesheet" href="./src/components/Statusbar/Statusbar.css" />
   <script src="./src/components/Statusbar/Statusbar.js"></script>

   <!-- tools -->
   <script src="./src/components/Toolbox/Tools/Pencil.js"></script>
</head>

<body>
   <div class="layout">
      <div class="row">
         <div class="appbar">pixel art editor</div>
      </div>
      <div class="row flex">
         <div class="column">
            <div class="pallet"></div>
         </div>
         <div class="column fill">
            <div class="easel"></div>
         </div>
         <div class="column">
            <div class="toolbox"></div>
         </div>
      </div>
      <div class="row">
         <div class="statusbar"></div>
      </div>
   </div>

   <script>
      var app = {}
      app.html = {
         appbar: document.querySelector('.appbar'),
         pallet: document.querySelector('.pallet'),
         easel: document.querySelector('.easel'),
         toolbox: document.querySelector('.toolbox'),
         statusbar: document.querySelector('.statusbar')
      }

      app.global = {}
      app.image = {
         width: 32,
         height: 32,
         pixels: []
      }

      app.script = {
         bakeHTML: function(recipe) {
            var bakedHTML = {
               elements: [],
               appendTo: function(parent) {
                  for (var element of this.elements) {
                     parent.appendChild(element)
                  }
               }
            }

            for (var template of recipe) {
               var element = document.createElement(template.tag || 'div')
               element.innerHTML = template.innerHTML || ''
               // add styles / classes / children / events
               for (var style in template.styles || [])
                  element.style[style] = template.styles[style]

               for (var className of template.classes || [])
                  element.classList.add(className)

               if (template.children)
                  app.script.bakeHTML(template.children).appendTo(element)

               for(var append of template.append || [])
                  element.appendChild(append)

               // let does something interesting here
               for (let eventName in template.events || []) {
                  element.addEventListener(eventName, (e) => {
                     template.events[eventName](e, element)
                  })
               }

               bakedHTML.elements.push(element)
            }
            return bakedHTML
         },
         onNew: function() {

         },
         addPixel: function(position) {
            var color = app.component.pallet.color
            app.image.pixels.push({ position, color })

            app.component.canvas.renderImage(app.image)
         }
      }

      app.component = {}
      app.component.appbar = new Appbar(app.html.appbar)
      app.component.statusbar = new Statusbar(app.html.statusbar, {
         status: {
            scale: '[ scale: 1 ]',
            pos: '[ pos: 0, 0 ]',
         }
      })

      app.component.pallet = new Pallet(app.html.pallet)
      app.component.tools = new Toolbox(app.html.toolbox)

      app.component.canvas = new Canvas({
         image: app.image,
         onDown: (mouse) => {

         },
         onStroke: (mouse) => {
            app.component.tools.stroke(mouse)
         },
         onMove: (mouse) => {
            app.component.statusbar.updateStatus({
               pos: `[pos: ${mouse.positionCurrent.x}, ${mouse.positionCurrent.y}]`
            })
         }
      })

      app.component.easel = new Easel(app.html.easel, {
         canvas: app.component.canvas,
         onScale: (scale) => {
            app.component.statusbar.updateStatus({
               scale: `[scale: ${scale}]`
            })
         }
      })

   </script>
</body>

</html>
